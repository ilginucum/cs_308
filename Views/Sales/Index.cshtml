@model IEnumerable<e_commerce.Models.Product>
@{
    ViewData["Title"] = "Sales Management";
    Layout = "_Layout";
    
    var productsWithoutPrice = Model.Where(p => p.Price == 0.0M);
    var productsWithPrice = Model.Where(p => p.Price > 0.0M);
}

<div class="container-fluid mt-4">
    <h2 class="text-center mb-4">Sales Management</h2>

    <div class="row">
        <!-- Left Side - Products without price -->
        <div class="col-md-6 border-end">
            <div class="card">
                <div class="card-header bg-warning">
                    <h4 class="mb-0 text-center">Products Awaiting Price</h4>
                </div>
                <div class="card-body">
                    @if (!productsWithoutPrice.Any())
                    {
                        <div class="alert alert-info">
                            No products awaiting price setting.
                        </div>
                    }
                    else
                    {
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>Book Name</th>
                                        <th>Author</th>
                                        <th>Genre</th>
                                        <th>Stock</th>
                                        <th>Action</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var product in productsWithoutPrice)
                                    {
                                        <tr>
                                            <td>@product.Name</td>
                                            <td>@product.Author</td>
                                            <td>@product.Genre</td>
                                            <td>@product.QuantityInStock</td>
                                            <td>
                                                <a asp-action="SetPrice" asp-route-id="@product.Id" 
                                                   class="btn btn-primary btn-sm">
                                                    Set Price
                                                </a>
                                            </td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                    }
                </div>
            </div>
        </div>

        <!-- Right Side - Products with price -->
        <div class="col-md-6">
            <div class="card">
                <div class="card-header bg-success text-white">
                    <h4 class="mb-0 text-center">Products with Price Set</h4>
                </div>
                <div class="card-body">
                    @if (!productsWithPrice.Any())
                    {
                        <div class="alert alert-info">
                            No products with prices set.
                        </div>
                    }
                    else
                    {
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>Book Name</th>
                                        <th>Author</th>
                                        <th>Current Price</th>
                                        <th>Stock</th>
                                        <th>Action</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var product in productsWithPrice)
                                    {
                                        <tr>
                                            <td>@product.Name</td>
                                            <td>@product.Author</td>
                                            <td class="text-success fw-bold">
                                                @product.Price.ToString("C")
                                            </td>
                                            <td>@product.QuantityInStock</td>
                                            <td>
                                                <a asp-action="SetPrice" asp-route-id="@product.Id" 
                                                   class="btn btn-outline-primary btn-sm">
                                                    Update Price
                                                </a>
                                            </td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        // Add animation when a price is set
        $(document).ready(function() {
            // Check if we just returned from setting a price
            const urlParams = new URLSearchParams(window.location.search);
            const justUpdated = urlParams.get('updated');
            
            if (justUpdated) {
                // Highlight the updated row briefly
                const updatedRow = $(`tr[data-product-id='${justUpdated}']`);
                updatedRow.addClass('bg-success text-white');
                setTimeout(() => {
                    updatedRow.removeClass('bg-success text-white');
                }, 2000);
            }
        });
    </script>
}